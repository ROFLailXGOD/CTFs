# Welcome Reverser (374 points)

> Hello and welcome to FwordCTF2k20 Let's start with something to warmup GOOD LUCK and have fun
nc welcome.fword.wtf 5000

В приложениях также лежит файл [welcome](./welcome).

```shell script
$ file welcome
welcome: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, 
interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=1e38490f943da8e022679d6463693b486d791b3e, 
for GNU/Linux 3.2.0, stripped
```

Открытие в Ghidra, к удивлению, помогло слабо - почему-то main не был определён (*Примечание:* среди write-up'ов
я видел то, что Ghidra справилась с задачей. Может что-то дополнительно установить надо?). Тогда я решил попросить 
знакомого с IDA проверить, как дела обстоят там. В ответ он мне скинул немного "причёсанный" вариант:

```c
strvbuf_fun();
  v6 = malloc_0(16);
  puts_0("Hello give me the secret number so i can get the flag:");
  scanf("%s", v6);
  if ( has_no_zeroes(v6) && strlen_0(v6) == 16 )
  {
    v4 = hash1(v6);
    if ( !((signed int)(v4 + hash2(v6)) % 10) )
    {
      some_flag_stuff((__int64)&v7);
      return 0LL;
    }
    puts_0("no thats not my number:(");
  }
  puts_0("no Flag for u");
```

Итого видим, что есть проверка на то, что во входной строке нет нулей и длина строки равна 16. Далее 
считается первый хеш, потом второй и результаты суммируется. Если результат оканчивается на 0, то мы получаем флаг.
Функции хеша я просмотрел в ghidra. Если кратко, то там немало математики, но распутать можно. Но я пошёл другим путём:
раз уж у меня есть декомпилированный код функций, то почему бы его не использовать? В итоге я написал простенький 
[welcome_reverser.c](./welcome_reverser.c), в который просто скопировал код из Ghidra и в main вывел результат.
Первой строкой я попробовал 11 единиц (`1111111111111111`) и на выходе получил 24. Затем я заменил последнюю
цифру на 2 (`1111111111111112`) и получил 25. Аналогично заменил на 3 и получил 26. Тут я предположил, что
хеш просто увеличивается на 1 и заменил 3 на 7 (`1111111111111117`). Результатом было заветное число 30, которое 
проходит проверку.